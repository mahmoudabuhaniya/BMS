{% extends 'myproject/base.html' %}

{% block content %}

   
    <div class="container-fluid mt-4">

       

        <!-- Header -->
         <div class="d-flex justify-content-between align-items-center mb-4">
            <div class="d-flex align-items-center">
                <h1 class="h3 mb-0 text-primary fw-bold">DASHBOARD</h1>
                <span class="badge bg-success ms-3 rounded-pill px-3 py-2">Beneficiaries Data from InForm</span>
            </div>
        
        </div>

        

        <!-- Sync Button -->
       <div class="container mt-5">
    <div class="row g-4 justify-content-center">

        <!-- View Database Card -->
        <div class="col-12 col-sm-6 col-lg-4">
            <div class="card border-0 shadow h-100">
                <div class="card-body d-flex flex-column justify-content-between">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-subtitle text-muted mb-2">Beneficiaries</h6>
                            <h2 class="display-6 fw-bold text-primary mb-0">View Data</h2>
                        </div>
                        <div class="icon-shape bg-primary bg-opacity-10 text-primary rounded-circle p-3">
                            <i class="fas fa-database"></i>
                        </div>
                    </div>
                    <a href="{% url 'inform_data' %}" class="btn btn-outline-primary btn-sm mt-3 w-100 text-center">
                        View Database <i class="fas fa-arrow-right ms-1"></i>
                    </a>
                </div>
            </div>
        </div>

        <!-- Admin Panel Card -->
        <div class="col-12 col-sm-6 col-lg-4">
            <div class="card border-0 shadow h-100">
                <div class="card-body d-flex flex-column justify-content-between">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-subtitle text-muted mb-2">Admin Panel</h6>
                            <h2 class="display-6 fw-bold text-dark mb-0">Admin</h2>
                        </div>
                        <div class="icon-shape bg-dark bg-opacity-10 text-dark rounded-circle p-3">
                            <i class="fas fa-cogs"></i>
                        </div>
                    </div>
                    <a href="/admin" class="btn btn-outline-dark btn-sm mt-3 w-100 text-center">
                        Admin Panel <i class="fas fa-arrow-right ms-1"></i>
                    </a>
                </div>
            </div>
        </div>

        <!-- Sync Data Card -->
        <div class="col-12 col-sm-6 col-lg-4">
            <div class="card border-0 shadow h-100">
                <div class="card-body d-flex flex-column justify-content-between">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-subtitle text-muted mb-2">Load New Record</h6>
                            <h2 class="display-6 fw-bold text-success mb-0">Synchronization</h2>
                        </div>
                        <div class="icon-shape bg-success bg-opacity-10 text-success rounded-circle p-3">
                            <i class="fas fa-sync-alt"></i>
                        </div>
                    </div>
                    <button id="sync-btn" class="btn btn-outline-success btn-sm mt-3 w-100 text-center">
                        Sync Data <i class="fas fa-arrow-right ms-1"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Form IDs Card -->
        <div class="col-12 col-sm-6 col-lg-4">
            <div class="card border-0 shadow h-100">
                <div class="card-body d-flex flex-column justify-content-between">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-subtitle text-muted mb-2">Manage Form IDs</h6>
                            <h2 class="display-6 fw-bold text-primary mb-0">InForm</h2>
                        </div>
                        <div class="icon-shape bg-primary bg-opacity-10 text-primary rounded-circle p-3">
                            <i class="fas fa-id-badge"></i>
                        </div>
                    </div>
                    <a href="{% url 'manage_tokens' %}" class="btn btn-outline-primary btn-sm mt-3 w-100 text-center">
                        Form IDs <i class="fas fa-arrow-right ms-1"></i>
                    </a>
                </div>
            </div>
        </div>

    </div>
</div>

</div>




<script>
    document.getElementById("sync-btn").addEventListener("click", function () {
        const syncBtn = this;
        const statusDiv = document.getElementById("sync-status");

        syncBtn.disabled = true;
        statusDiv.innerHTML = '<div class="alert alert-info">⏳ Syncing data, please wait...</div>';

        fetch("{% url 'sync_inform_data' %}", {
            method: "POST",
            headers: {
                "X-CSRFToken": "{{ csrf_token }}",
                "X-Requested-With": "XMLHttpRequest"
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === "success") {
                statusDiv.innerHTML = `<div class="alert alert-success">${data.message}</div>`;
                document.getElementById("last-sync-time").innerText = data.last_sync; // ✅ Update last sync time
                
            } else {
                statusDiv.innerHTML = `<div class="alert alert-danger">${data.message}</div>`;
            }
        })
        .catch(error => {
            statusDiv.innerHTML = '<div class="alert alert-danger">❌ Sync failed: Network error</div>';
        })
        .finally(() => {
            syncBtn.disabled = false;
            setTimeout(() => statusDiv.innerHTML = '', 5000); // Auto-hide after 5 sec
            setTimeout(() => {
            window.location.reload();
        }, 5000); // Adjust this to match the fade duration
        });
    });
</script>
    </div>

    <script>
        setTimeout(() => {
            document.querySelectorAll('.fade-out').forEach(el => el.classList.add('hide'));
        }, 5000);
    </script>


{% endblock %}
